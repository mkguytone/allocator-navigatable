<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>パート IV. glibc から malloc() の基本構造を理解してみる</title><link rel="stylesheet" type="text/css" href="index.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Linux で C/C++ の足固め： Linux の メモリー/ファイル/mmap と C++ アロケーター" /><link rel="up" href="index.html" title="Linux で C/C++ の足固め： Linux の メモリー/ファイル/mmap と C++ アロケーター" /><link rel="prev" href="ch27s02.html" title="27.2. strace によって brk() / malloc() のコールをチェック" /><link rel="next" href="ch28.html" title="第28章 malloc() の内部実装" /><meta xmlns="" name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0" /><script xmlns="" type="text/javascript" src="prettify/prettify.js"></script><link xmlns="" rel="stylesheet" type="text/css" href="prettify/skins/sons-of-obsidian.css" /><script xmlns="">
    window.addEventListener("load", function() {
      PR.prettyPrint();
	  });	
	</script><script xmlns="" type="text/javascript" src="script/head.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch27s02.html">戻る</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch28.html">次へ</a></td></tr></table><hr /></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="_glibc_から_malloc_の基本構造を理解してみる"></a>パート IV. glibc から malloc() の基本構造を理解してみる</h1></div></div></div><div class="toc"><p><strong>目次</strong></p><dl class="toc"><dt><span class="chapter"><a href="ch28.html">28. malloc() の内部実装</a></span></dt><dt><span class="chapter"><a href="ch29.html">29. アリーナによるマルチスレッド対応</a></span></dt><dt><span class="chapter"><a href="ch30.html">30. アリーナオブジェクト（ main_arena / malloc_state ）</a></span></dt><dt><span class="chapter"><a href="ch31.html">31. ヒープのヘッダーオブジェクト（ heap_info )</a></span></dt><dt><span class="chapter"><a href="ch32.html">32. チャンク（ malloc_chunk ）</a></span></dt><dt><span class="chapter"><a href="ch33.html">33. 最少チャンクサイズと最少割り当てサイズ</a></span></dt><dt><span class="chapter"><a href="ch34.html">34. malloc_par</a></span></dt><dt><span class="chapter"><a href="ch35.html">35. top チャンク</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s01.html">35.1. ビン</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch36.html">36. 未整理ビン / スモールビン / ラージビン</a></span></dt><dt><span class="chapter"><a href="ch37.html">37. ビンのインデックスの計算</a></span></dt><dd><dl><dt><span class="section"><a href="ch37s01.html">37.1. 32 ビットアーキテクチャのビン</a></span></dt><dt><span class="section"><a href="ch37s02.html">37.2. 64 ビットアーキテクチャのビン</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch38.html">38. ビン・インデックスのまとめ</a></span></dt><dt><span class="chapter"><a href="ch39.html">39. ビンのチャンク連結</a></span></dt><dt><span class="chapter"><a href="ch40.html">40. ビンの初期化</a></span></dt><dt><span class="chapter"><a href="ch41.html">41. 未整理チャンク（ Unsorted Chunk ）のマクロ</a></span></dt><dt><span class="chapter"><a href="ch42.html">42. トップチャンク（ Top Chunk ）のマクロ</a></span></dt><dt><span class="chapter"><a href="ch43.html">43. Binmap のマクロ</a></span></dt><dt><span class="chapter"><a href="ch44.html">44. tcache</a></span></dt><dt><span class="chapter"><a href="ch45.html">45. malloc() フリーチャンクの挙動</a></span></dt><dt><span class="chapter"><a href="ch46.html">46. malloc.c の内部マクロ</a></span></dt><dd><dl><dt><span class="section"><a href="ch46s01.html">46.1. チャンクを取り扱えるマクロ</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch47.html">47. ファーストビンの解放</a></span></dt><dt><span class="chapter"><a href="ch48.html">48. malloc.c の内部関数</a></span></dt><dt><span class="chapter"><a href="ch49.html">49. malloc() の実装</a></span></dt><dd><dl><dt><span class="section"><a href="ch49s01.html">49.1. _int_malloc() 関数</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch50.html">50. free() の実装</a></span></dt><dt><span class="chapter"><a href="ch51.html">51. calloc()</a></span></dt><dt><span class="chapter"><a href="ch52.html">52. realloc()</a></span></dt><dt><span class="chapter"><a href="ch53.html">53. alloca() 関数</a></span></dt><dd><dl><dt><span class="section"><a href="ch53s01.html">53.1. alloca() の使用法</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch54.html">54. posix_memalign() / aligned_alloc()</a></span></dt><dd><dl><dt><span class="section"><a href="ch54s01.html">54.1. glibc-2.7 の内部実装</a></span></dt><dt><span class="section"><a href="ch54s02.html">54.2. アラインメントの仕組み</a></span></dt><dt><span class="section"><a href="ch54s03.html">54.3. アラインメントの最少サイズ</a></span></dt><dt><span class="section"><a href="ch54s04.html">54.4. 大きめのアラインメント</a></span></dt><dt><span class="section"><a href="ch54s05.html">54.5. 複数のアラインメントでの検証</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch55.html">55. std::launder ( C++17 )</a></span></dt><dt><span class="chapter"><a href="ch56.html">56. std::aligned_storage ( C++11 )</a></span></dt><dt><span class="chapter"><a href="ch57.html">57. std::align ( C++11 )</a></span></dt><dt><span class="chapter"><a href="ch58.html">58. std::aligned_alloc ( C++17 )</a></span></dt></dl></div><p>　glibc は GNU-C のライブラリーです。</p><p>　C++ のコンパイラなんかもこれを使っています。</p><p>　malloc() 関数の実装も glibc に含まれます。</p><p>　ということでメモリー管理を掘り下げたいなら glibc を少し学んでおく必要があります。</p><p>　とは言っても glibc 全部の説明なんて、とてもじゃないけどできません。</p><p>　それで詳細のチェックは読者におまかせしますが、まずはソースコードを読める環境だけは整えようじゃありませんか。</p><p>　まずは現在使われている glibc のバージョンをチェックです。</p><pre xmlns="" class="prettyprint">$ ldd --version
ldd (Ubuntu GLIBC 2.27-3ubuntu1) 2.27
Copyright (C) 2018 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
作者 Roland McGrath および Ulrich Drepper。</pre><p>　それと glibc のライブラリーはコマンド（実行可能ファイル）として使うと、バージョンがチェックできます。</p><pre xmlns="" class="prettyprint">$ /lib/x86_64-linux-gnu/libc.so.6
GNU C Library (Ubuntu GLIBC 2.27-3ubuntu1) stable release version 2.27.
Copyright (C) 2018 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.
Compiled by GNU CC version 7.3.0.
libc ABIs: UNIQUE IFUNC
For bug reporting instructions, please see:
&lt;https://bugs.launchpad.net/ubuntu/+source/glibc/+bugs&gt;.</pre><p>　その他にもバージョンの調べ方は色々あるので読者におまかせしますね。</p><p>　最後に glibc を github からダウンロードする必要があるんですが、これは読者が自分で調べることを進めますが、一応以下のように bminor さんという方がリポジトリーを作っているのでクローンできるようになっています。</p><pre xmlns="" class="prettyprint">$ git clone -b release/2.27/master https://github.com/MacKomatsu/glibc.git</pre><p>　https://github.com/MacKomatsu/glibc.git リポジトリーは bminor の glibc というリポジトリーを2018年にフォークしたものです。</p><p>　コマンドの方は「release/2.27/master」というブランチを指定してクローンしています。</p><p>　筆者も glibc に詳しい「ニキ」（アニキ、アネキの短縮形として 2ch で誕生した言葉らしい）ではないので glibc-2.27 のリリース版と勝手に理解しています。</p><p>　まあ、ブランチが多すぎて、何がリリースなのか分からないといきはリリースと名前のついたものを見つけておけば、大体は古いバージョンのリリース版なので、間違ってはないと思います。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch27s02.html">戻る</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch28.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div><wrapper xmlns=""><p>Copyright 2018-2019, by Masaki Komatsu</p>


</wrapper></body></html>